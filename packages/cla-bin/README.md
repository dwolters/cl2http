# Adapter to Provide a (RESTful) HTTP Interface for Command-Line Applications

This adapter allows users to easily enrich an existing command-line tool with a (RESTful) HTTP API via an extended [OpenAPI](https://swagger.io/specification/) (fka Swagger) service description. The adapter supports the following features:

- invoking existing command-line tools via HTTP(S) based on associated URLs
- mapping parameters specified in the HTTP request's header/query/path/body to arguments of the command-line tool
- writing the HTTP request body to a file before passing it to the command-line tool
- creating the HTTP response from a file (static or generated by the command-line tool)
- authentication support (via  HTTP Basic Auth or HTTP Bearer Tokens/API Keys)
- deploying the service as a [Docker](https://www.docker.com/what-container) container or as an [AWS Lambda](#) Cloud Function, including additional dependencies

Furthermore, the underlying OpenAPI specification serves as an API documentation. Users can leverage existing OpenAPI [tools](https://swagger.io/tools/) to write the OpenAPI specification or to create client code for the described service.

## Example

The following specification provides a simple example of a "Hello World" service, which when invoked at `http://localhost:8000/hello?name=world` utilizes the `echo` command-line tool to return the string `Hello world!`.

```yaml
swagger: '2.0'
info:
  version: 1.0.0
  title: Test Service
  description: Testing `cli-adapter`.
host: localhost:8000
paths:
  '/hello':
    get:
      parameters:
        -
          name: name
          in: query
          required: true
          schema:
            type: string
      x-cli:
        command: echo Hello ${=name}!
        headers:
          Content-Type: text/plain
      responses:
        200:
          description: ok
```

To start the service encapsuled in a Docker container, simply execute:

```sh
```

## Next Steps

- follow the [installation instructions](#installation) to try the above example yourself
- check the [usage information](#usage) for more details on how to use the tool
- visit the `/examples` folder to see more example specifications
- learn how to write your own specifications by reading the [documentation of OpenAPI extensions](OpenAPI-Extensions.md)


## Installation

*Prerequisites: Node.js (version 8.6 or higher), including NPM*

The tool can be installed globally via:
```sh
npm install -g cla-bin
```

> *Note:* Since this package and parts of its dependencies have not yet been published to the *npm* registry, the above command will currently not work! Instead, the `cla` tool can be invoked by executing `npm run cl2http -- <cla command-line parameters>` from the root directory of the repository.

### Additional requirements
- If you want to use [Docker](https://www.docker.com/get-docker) deployment, make sure that Docker is installed and running!
- If want to deploy a service with Amazon Web Services (AWS), make sure that the [AWS CLI](https://aws.amazon.com/cli/) is installed and [configured to access your AWS account](https://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html) (e.g., via `aws configure`). Also, a S3 bucket is required to store the files required for deployment.

## Usage

**All service descriptions have to be provided in JSON format! Costs from AWS deployment may incur if you exceed the free tier limits of the used resources (see [this document](../cla-lambda/README.md#used-aws-resources) for more information about used AWS resources).**

The `cl2http` tool includes a help command which provides detailed information about subcommands and their options:

```
$ cl2http --help

  Usage: main [options] [command] <path-to-service-description>

  Makes a CLI tool available as a (RESTful) web service using the provided OpenAPI v2.0/v3.0.x service description.

  Options:

    -V, --version     output the version number
    -h, --help        output usage information

  Commands:

    start             Starts the server described by the given description.
    sanitize          Prints the given service description with any cli-adapter specific information removed.
    emit              Outputs the Dockerfile generated for the given service description.
    build [options]   Builds the Docker Image for the given service.
    serve [options]   Starts the service as a Docker Container
    deploy [options]  Deploys the service as an AWS Lambda function accessible via AWS ApiGateway.

$ cl2http serve --help

  Usage: serve [options]

  Starts the service as a Docker Container

  Options:

    -l, --local                  Use local development version of cli-adapter instead of published one.
    -s, --skip-build             Skip build process.
    -t, --tag [name]             Name of the image to serve.
    -c, --container-name [name]  Name of the container.
    -h, --help                   output usage information
```

> *Reminder:* If you have **not** obtained the `cl2http` tool via *npm*, invoke `npm run cl2http -- --help` from the root of the repository instead!

## Development & Testing

Further information about development and testing is provided at the [root README](../../README.md).
